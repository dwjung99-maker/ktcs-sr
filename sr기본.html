<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KT CS 대전무선 - SR 판독기 (멀티 초이스)</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid #dcdcdc; }
        
        h1 { color: #111; text-align: center; margin-bottom: 5px; font-weight: 800; letter-spacing: -1px; }
        .brand { color: #eb003c; } 
        .badge { background: #eb003c; color: #fff; padding: 4px 12px; border-radius: 20px; font-size: 13px; font-weight: 600; display: inline-block; margin-bottom: 25px; }
        
        textarea { width: 100%; height: 100px; padding: 15px; border: 2px solid #ddd; border-radius: 12px; font-size: 17px; resize: none; background-color: #fafafa; outline: none; transition: 0.3s; }
        textarea:focus { border-color: #eb003c; background-color: #fff; }
        
        button { width: 100%; background-color: #222; color: white; padding: 16px; border: none; border-radius: 12px; font-size: 19px; font-weight: bold; cursor: pointer; margin-top: 15px; transition: 0.2s; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        button:hover { background-color: #444; }

        /* 결과 리스트 스타일 */
        #resultContainer { margin-top: 30px; display: none; }
        
        .result-card { 
            background: #fff; 
            border: 1px solid #e0e0e0; 
            border-left: 6px solid #ccc; /* 기본 색상 */
            padding: 20px; 
            border-radius: 8px; 
            margin-bottom: 15px; 
            transition: 0.2s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        /* 1순위 추천 강조 */
        .result-card.best-match {
            border-left-color: #eb003c;
            background-color: #fffbfc;
            border-color: #ffccd5;
            box-shadow: 0 4px 12px rgba(235, 0, 60, 0.1);
        }

        .rank-badge { font-size: 12px; font-weight: bold; color: #fff; background: #999; padding: 2px 8px; border-radius: 4px; margin-bottom: 5px; display: inline-block; }
        .best-match .rank-badge { background: #eb003c; }

        .sr-code { font-size: 22px; font-weight: 800; color: #222; margin-bottom: 8px; display: block; line-height: 1.3; }
        .reason { font-size: 15px; color: #555; line-height: 1.5; margin-bottom: 10px; }
        
        .match-detail { font-size: 13px; color: #eb003c; font-weight: bold; background: #f0f0f0; padding: 5px 10px; border-radius: 6px; display: inline-block; }
        .best-match .match-detail { background: #ffe6ea; }
    </style>
</head>
<body>

<div class="container">
    <div style="text-align:center;">
        <span class="badge">V9.0 (중복 검색 / 멀티뷰 지원)</span>
    </div>
    <h1><span class="brand">KT CS</span> 지능형 SR 판독기</h1>
    <p style="text-align:center; color:#666; font-size:15px; margin-bottom:30px;">
        상황이 애매할 땐 <strong>모든 가능성</strong>을 보여줍니다. 가장 적절한 것을 고르세요.
    </p>
    
    <textarea id="inputText" placeholder="상담 내용을 입력하세요.&#13;&#10;예시: 500건 차단됐는데 자동해제가 안 된다고 함"></textarea>
    <button onclick="analyzeSR()">판독하기 (Enter)</button>
    
    <div id="resultContainer"></div>
</div>

<script>
    // =========================================================
    // [KT CS 대전무선] V9.0 데이터베이스
    // ★핵심: 동일한 상황이라도 '미세한 조건'에 따라 여러 규칙을 생성함
    // =========================================================
    var srRules = [
        
        // ================= [1. 무선 특수: 스팸/500건 (4가지 상황 분리)] =================
        {
            // Case 1: 자동해제 실패 (팀장님 강조)
            keywords: ["500건", "스팸", "차단"],
            subKeywords: ["자동", "안풀려", "다음날", "안됨", "실패"], // 이게 있어야 이 규칙이 발동
            exclude: [],
            code: "변경/조회 > 일시정지/해제 > 일시정지해제문의",
            reason: "★중요: 일 500건 차단 후, 다음날 '자동 해제'가 시스템상 안 되어 문의한 경우입니다."
        },
        {
            // Case 2: 1선 종결/수긍
            keywords: ["500건", "스팸", "이용정지"],
            subKeywords: ["종결", "수긍", "완결", "1선", "처리", "설명"],
            exclude: ["이관", "부서"],
            code: "변경/조회 > 일시정지/해제 > 일시정지해제문의",
            reason: "★중요: 스팸/이용정지 건이지만, 이관하지 않고 상담사가 설명하여 '고객 수긍 후 종결'된 건입니다."
        },
        {
            // Case 3: 일반 해제 요청 (가장 기본)
            keywords: ["500건", "스팸", "문자차단", "문자제한", "이용정지", "발송차단"],
            subKeywords: [], // 필수 조건 없음 (기본값)
            exclude: ["종결", "수긍", "자동", "예외"],
            code: "변경/조회 > 일시정지/해제 > 일500건이용정지해제",
            reason: "일반적인 문자 대량 발송(500건 초과) 차단 해제 요청입니다. (스팸팀 이관 등)"
        },
        {
            // Case 4: 예외 등록
            keywords: ["예외등록", "500건예외", "택배", "대리", "생계"],
            subKeywords: [],
            exclude: [],
            code: "변경/조회 > 일시정지/해제 > 일500건예외등록",
            reason: "업무상(택배, 대리 등) 문자 발송이 많아 차단 예외 등록을 요청하는 경우입니다."
        },

        // ================= [2. 무선 로밍 (디테일 분기)] =================
        {
            keywords: ["로밍", "해외"],
            subKeywords: ["가입", "해지", "차단", "변경", "신청", "돼지코"],
            exclude: ["조회", "확인"],
            code: "변경/조회 > 상품변경 > 로밍부가서비스변경/해지",
            reason: "해외 로밍 서비스의 가입, 해지, 차단, 변경 등 '상태를 바꾸는' 업무입니다."
        },
        {
            keywords: ["로밍", "해외", "데이터"],
            subKeywords: ["조회", "확인", "얼마", "잔여", "남았"],
            exclude: ["해지", "가입", "차단"],
            code: "변경/조회 > 상품변경 > 로밍부가서비스조회/확인",
            reason: "단순히 로밍 가입 여부나 데이터 잔여량을 '확인'하는 업무입니다."
        },


        // ================= [3. 무선 기기/유심 (OMD 등)] =================
        {
            keywords: ["자급제", "중고폰", "유심", "등록"],
            subKeywords: ["기변", "변경", "OMD", "맥", "MAC", "모델명"],
            exclude: [],
            code: "변경/조회 > 개인정보 > 개인정보 관련 문의",
            reason: "자급제/중고폰 사용을 위한 기기등록(OMD) 및 유심기변 처리 건입니다."
        },
        {
            keywords: ["기변", "기기변경", "폰교체"],
            subKeywords: ["문의", "방법", "새폰", "재고"],
            exclude: ["보상", "유심", "분실"],
            code: "변경/조회 > 기기변경 > 기기변경 문의",
            reason: "일반적인 단말기 교체 절차 및 재고 문의입니다."
        },


        // ================= [4. 무선 정지/해제 (분실 vs 일반)] =================
        {
            keywords: ["분실", "잃어버", "도난"],
            subKeywords: ["정지", "신고", "습득"],
            exclude: ["파손", "보험가입"],
            code: "변경/조회 > 일시정지/해제 > 분실/고장접수(단말보험_미가입자)신청",
            reason: "휴대폰 분실로 인한 정지 요청입니다. (보험 미확인)"
        },
        {
            keywords: ["정지", "일시정지"],
            subKeywords: ["군대", "유학", "해외", "장기", "입대"],
            exclude: [],
            code: "변경/조회 > 일시정지/해제 > 일시정지문의",
            reason: "군대, 유학, 해외체류 등 장기적인 사유로 인한 정지 문의입니다."
        },
        {
            keywords: ["해제", "정지해제"],
            subKeywords: ["풀어", "다시", "귀국", "복구"],
            exclude: ["스팸", "500건"],
            code: "변경/조회 > 일시정지/해제 > 일시정지해제문의",
            reason: "일반 일시정지 상태를 해제하여 다시 사용하려는 문의입니다."
        }
    ];

    function analyzeSR() {
        var text = document.getElementById("inputText").value;
        var resultContainer = document.getElementById("resultContainer");

        if (!text.trim()) { alert("내용을 입력해주세요!"); return; }

        var cleanText = text.replace(/ /g, "").replace(/-/g, "").replace(/_/g, "");
        var candidates = [];

        // 모든 규칙 검사
        for (var i = 0; i < srRules.length; i++) {
            var rule = srRules[i];
            var score = 0;
            var matchedMain = [];
            var matchedSub = [];

            // 1. 메인 키워드 검사 (기본 점수)
            for (var j = 0; j < rule.keywords.length; j++) {
                if (cleanText.indexOf(rule.keywords[j]) !== -1) {
                    score += 10;
                    matchedMain.push(rule.keywords[j]);
                }
            }

            // 2. 서브 키워드 검사 (가중치 점수 - 상황을 구체화하는 단어)
            if (rule.subKeywords && rule.subKeywords.length > 0) {
                var subFound = false;
                for (var s = 0; s < rule.subKeywords.length; s++) {
                    if (cleanText.indexOf(rule.subKeywords[s]) !== -1) {
                        score += 30; // 서브 키워드가 있으면 점수 대폭 상승
                        matchedSub.push(rule.subKeywords[s]);
                        subFound = true;
                    }
                }
                // 서브 키워드가 필수인데 하나도 없으면 점수 깎음 (단, 일반 룰은 제외)
                // if (!subFound) score -= 5; 
            }

            // 3. 제외어 검사 (탈락)
            if (rule.exclude) {
                for (var k = 0; k < rule.exclude.length; k++) {
                    if (cleanText.indexOf(rule.exclude[k]) !== -1) {
                        score = -999;
                    }
                }
            }

            // 점수가 0점 이상인 후보는 모두 수집
            if (score > 0 && matchedMain.length > 0) {
                candidates.push({
                    rule: rule,
                    score: score,
                    tags: matchedMain.concat(matchedSub)
                });
            }
        }

        // 결과 출력
        resultContainer.style.display = "block";
        resultContainer.innerHTML = "";

        if (candidates.length === 0) {
            resultContainer.innerHTML = "<div class='result-card' style='text-align:center; color:#666;'>❓ 판독 가능한 결과가 없습니다.<br>검색어(500건, 로밍, 정지 등)를 포함해 주세요.</div>";
            return;
        }

        // 점수순 정렬
        candidates.sort(function(a, b) { return b.score - a.score });

        // 리스트 생성
        for (var c = 0; c < candidates.length; c++) {
            var item = candidates[c];
            var isBest = (c === 0); // 1등만 강조
            
            var tagHtml = item.tags.map(t => "#" + t).join(" ");

            var html = `
                <div class="result-card ${isBest ? 'best-match' : ''}">
                    <span class="rank-badge">${isBest ? '⭐ 최우선 추천' : (c+1) + '순위 후보'}</span>
                    <span class="sr-code">${item.rule.code}</span>
                    <div class="reason">${item.rule.reason}</div>
                    <div class="match-detail">감지된 단어: ${tagHtml}</div>
                </div>
            `;
            resultContainer.innerHTML += html;
        }
    }

    // 엔터키 지원
    document.getElementById("inputText").addEventListener("keypress", function(e) {
        if (e.key === "Enter") {
            e.preventDefault();
            analyzeSR();
        }
    });
</script>

</body>
</html>
